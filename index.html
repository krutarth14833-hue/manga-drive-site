<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Manga Reader</title>

<style>
body {
    font-family: Arial;
    background: #111;
    color: white;
    margin: 0;
    padding: 0;
    text-align: center;
}
h1, h2 { margin: 10px 0; }

#carousel {
    width: 90%;
    height: 350px;
    margin: 20px auto;
    overflow: hidden;
    border-radius: 15px;
    position: relative;
}
#carousel-images {
    display: flex;
    transition: 0.4s ease;
}
#carousel-images img {
    width: 100%;
    height: 350px;
    object-fit: cover;
}

/* Buttons */
button {
    background: #ff4757;
    border: none;
    padding: 10px 20px;
    margin: 5px;
    color: white;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
}
button:hover { opacity: 0.8; }
.login-required-btn { background: gray; cursor: not-allowed; }

/* Lists */
#manga-list li, #popular-list li {
    background: #222;
    margin: 8px auto;
    padding: 10px;
    width: 90%;
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

input {
    width: 90%;
    padding: 10px;
    margin: 10px auto;
    font-size: 16px;
    border-radius: 6px;
    border: none;
}

/* Admin */
#admin-section {
    background: #222;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    margin: 20px auto;
    display: none;
}
</style>
</head>

<body>

<h1>Manga Reader</h1>

<!-- User Info -->
<p>Logged in as: <span id="user-email">Not logged in</span></p>
<button id="login-btn" onclick="googleLogin()">Login with Google</button>
<button id="logout-btn" onclick="logout()" style="display:none;">Logout</button>

<hr>

<!-- Search -->
<input type="text" id="search-bar" placeholder="Login to search..." disabled />

<!-- Login message -->
<p id="login-message" style="color:red; display:block;">Please log in to access all manga.</p>

<!-- Carousel -->
<div id="carousel">
    <div id="carousel-images"></div>
</div>
<button id="prev-btn">Prev</button><button id="next-btn">Next</button>

<h2>Popular Manga</h2>
<ul id="popular-list"></ul>

<h2>All Manga</h2>
<ul id="manga-list"></ul>

<!-- Admin Panel -->
<div id="admin-section">
    <h2>Admin Panel</h2>
    <input id="new-title" placeholder="Manga title" />
    <input id="new-cover" placeholder="Cover image URL" />
    <input id="new-link" placeholder="Google Drive link" />
    <button onclick="addManga()">Add Manga</button>
</div>

<!-- GOOGLE LOGIN SDK -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>

<script>
// ---------------- CONFIG ----------------
const GOOGLE_CLIENT_ID = "YOUR_GOOGLE_CLIENT_ID_HERE";
const OWNER_EMAIL = "YOUR_EMAIL@gmail.com";

// ------------- MANGA DATABASE -----------
let mangaDB = [
    {
        title: "One Piece Vol 1",
        cover: "https://i.imgur.com/1P2pYzW.jpg",
        link: "https://drive.google.com/file/d/FILE_ID/view",
        usage: 0
    },
    {
        title: "Naruto Vol 1",
        cover: "https://i.imgur.com/9v0GBG6.jpg",
        link: "https://drive.google.com/file/d/FILE_ID/view",
        usage: 0
    }
];

let userEmail = null;

// ---------------- GOOGLE LOGIN ----------------
function googleLogin() {
    google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: handleResponse
    });
    google.accounts.id.prompt();
}

function handleResponse(res) {
    const data = jwt_decode(res.credential);
    userEmail = data.email;

    document.getElementById("user-email").textContent = userEmail;
    document.getElementById("login-btn").style.display = "none";
    document.getElementById("logout-btn").style.display = "inline-block";
    document.getElementById("login-message").style.display = "none";

    enableFeatures();
}

function logout() {
    userEmail = null;
    document.getElementById("user-email").textContent = "Not logged in";
    document.getElementById("login-btn").style.display = "inline-block";
    document.getElementById("logout-btn").style.display = "none";

    disableFeatures();
}

// ---------------- ENABLE/DISABLE FEATURES ---------------
function enableFeatures() {
    document.getElementById("search-bar").disabled = false;
    document.getElementById("search-bar").placeholder = "Search manga...";
    
    if (userEmail === OWNER_EMAIL)
        document.getElementById("admin-section").style.display = "block";

    renderManga();
}

function disableFeatures() {
    document.getElementById("search-bar").disabled = true;
    document.getElementById("search-bar").placeholder = "Login to search...";
    
    document.getElementById("admin-section").style.display = "none";
    
    renderManga();
}

// ---------------- RENDER MANGA ----------------
function renderManga() {
    const list = document.getElementById("manga-list");
    const pop = document.getElementById("popular-list");

    list.innerHTML = "";
    pop.innerHTML = "";

    mangaDB.sort((a,b) => b.usage - a.usage);

    mangaDB.forEach((m, i) => {
        // Main list
        const li = document.createElement("li");
        li.innerHTML = `
            <span>${m.title}</span>
            ${userEmail ? 
            `<button onclick="openManga(${i})">Read</button>` :
            `<button class="login-required-btn">Locked</button>` }
        `;
        list.appendChild(li);

        // Popular (top 5)
        if (i < 5) {
            const li2 = li.cloneNode(true);
            pop.appendChild(li2);
        }
    });
}

// ---------------- OPEN MANGA ----------------
function openManga(i) {
    mangaDB[i].usage++;
    window.open(mangaDB[i].link, "_blank");
    renderManga();
}

// ---------------- ADD MANGA (ADMIN) ----------------
function addManga() {
    const t = document.getElementById("new-title").value;
    const c = document.getElementById("new-cover").value;
    const l = document.getElementById("new-link").value;

    if (!t || !c || !l) return alert("Fill all fields!");

    mangaDB.push({ title: t, cover: c, link: l, usage: 0 });
    loadCarousel();
    renderManga();

    document.getElementById("new-title").value = "";
    document.getElementById("new-cover").value = "";
    document.getElementById("new-link").value = "";
}

// ---------------- SEARCH ----------------
document.getElementById("search-bar").addEventListener("input", () => {
    const q = document.getElementById("search-bar").value.toLowerCase();
    const li = document.querySelectorAll("#manga-list li");
    
    li.forEach(item => {
        const name = item.textContent.toLowerCase();
        item.style.display = name.includes(q) ? "flex" : "none";
    });
});

// ---------------- CAROUSEL ----------------
function loadCarousel() {
    const c = document.getElementById("carousel-images");
    c.innerHTML = "";
    mangaDB.forEach(m => {
        const img = document.createElement("img");
        img.src = m.cover;
        c.appendChild(img);
    });
}
loadCarousel();

let index = 0;
function updateCarousel() {
    const w = document.getElementById("carousel").clientWidth;
    document.getElementById("carousel-images").style.transform = `translateX(${-index*w}px)`;
}
document.getElementById("next-btn").onclick = () => { index = (index + 1) % mangaDB.length; updateCarousel(); };
document.getElementById("prev-btn").onclick = () => { index = (index - 1 + mangaDB.length) % mangaDB.length; updateCarousel(); };

renderManga();
</script>
</body>
</html>
